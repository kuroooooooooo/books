<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="communityMapper">

   <insert id="insert" >
   		insert into Bookcommunity(
   			bno, 
   			title, 
   			content, 
   			user_id
   		) values(bookcommunity_SEQ.NEXTVAL,
   				#{title},
   				#{content},
   				#{userId}
   				)
   </insert>
   
   <select id="listPage" resultType="com.books.TO.CommunityTO" parameterType="com.books.TO.Criteria">
		   	select 
		    bno, title, content, user_id, regdate, cnt
		from (
		    select 
		        bno, title, content, user_id, regdate, cnt,
		        row_number() over(order by bno desc) as RNUM
		    from bookcommunity
		    where 1 = 1
		    <include refid="search"></include>
		    )b
		where RNUM between #{rowStart} and #{rowEnd}
		order by bno desc
   </select>
   
   <sql id="search">
   		<if test="searchType == 't'.toString()">AND TITLE LIKE '%' || #{keyword} || '%'</if>
   		<if test="searchType == 'c'.toString()">AND CONTENT LIKE '%' || #{keyword} || '%'</if>
   		<if test="searchType == 'w'.toString()">AND USER_ID LIKE '%' || #{keyword} || '%'</if>
   		<if test="searchType == 'tc'.toString()">AND (TITLE LIKE '%' || #{keyword} || '%') or (CONTENT LIKE '%' || #{keyword} || '%')</if>
   </sql>
   
   <select id="listCount" resultType="int">
   		SELECT 
			COUNT(BNO)
		  FROM 
		  	BookCommunity
		 WHERE 
		 	1 = 1
		 <include refid="search"></include>
		 	AND BNO > 0
 
   </select>
   
   
   <select id="read" parameterType="int" resultType="com.books.TO.CommunityTO">
   		SELECT bno, title, user_id, content
   		FROM BookCommunity
   		WHERE bno = #{bno}
   </select>
   
  <update id="update" parameterType="com.books.TO.CommunityTO">
  	UPDATE BookCommunity
  	SET title = #{title},
  		content = #{content}
  	WHERE bno = #{bno}
  </update>
  
  <delete id="delete" parameterType="int">
  	DELETE
  	FROM BookCommunity
  	WHERE bno = #{bno}
  </delete>
   
</mapper>